<!DOCTYPE html>
<html lang="pt-BR">

<head>

  <meta charset="UTF-8">
  <title>Divy - Gestﾃ｣o Inteligente de Tarefas</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#2563eb">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- PROTEﾃﾃグ DE AUTENTICAﾃﾃグ (deve ser o primeiro script) -->
  <script src="../scripts/auth.js"></script>

  <!-- CSS -->
  <link rel="stylesheet" href="../css/TelaPrincipal.css">
  <link rel="stylesheet" href="../css/sections.css">
  <link rel="stylesheet" href="../css/dark-mode-system.css">
  <link rel="stylesheet" href="../css/ai-routine-panel.css">
  <link rel="stylesheet" href="../css/subtasks.css">
  <link rel="stylesheet" href="../css/animations.css">
  <link rel="stylesheet" href="../css/nura-responsive.css">
  <link rel="stylesheet" href="../css/nura-mobile-extras.css">
  <link rel="stylesheet" href="../css/nura-all-modals-fix.css">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

  <!-- Font Awesome para ﾃｭcones -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Preconnect para performance -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

  
</head>

<body>
  <!-- Splash Screen com Logo Divy -->
  <div id="splash-screen">
    <div class="splash-content">
      <img src="../imgs/logo-texto-nova.jpeg" alt="Divy" class="splash-logo">
      <div class="splash-loader"></div>
    </div>
  </div>

  <div class="app-container">
    
    <!-- ===== OVERLAY DA SIDEBAR (MOBILE) ===== -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>
    
    <!-- ===== SIDEBAR ESQUERDA ===== -->
    <aside class="sidebar" id="sidebar">
      <!-- Logo/Brand -->
      <div class="sidebar-brand">
        <img src="../imgs/logo-texto-nova.jpeg" alt="Divy" class="brand-logo-img">

        <!-- Botﾃ｣o fechar sidebar (mobile) -->
        <button class="btn-close-sidebar hide-desktop" id="btnCloseSidebar" aria-label="Fechar menu">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>

      <!-- User Profile Mini -->
      <div class="sidebar-user">
        <div class="user-avatar">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
        </div>
        <div class="user-info">
          <span class="user-name">Minha Conta</span>
          <span class="user-plan" id="user-plan-badge">Carregando...</span>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="sidebar-section">
        <button class="btn-add-task" id="btnNovaGlobal">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
          <span class="hide-mobile-text">Nova Tarefa</span>
        </button>
      </div>

      <!-- Navigation -->
      <nav class="sidebar-nav">
        <a href="#" class="nav-item" data-filter="inbox" onclick="applySmartFilter('inbox'); closeSidebarMobile(); return false;">
          <span class="nav-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
              <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
          </span>
          <span class="nav-text">Caixa de Entrada</span>
          <span class="nav-badge" id="badge-inbox">0</span>
        </a>
        
        <a href="#" class="nav-item" data-filter="today" onclick="applySmartFilter('today'); closeSidebarMobile(); return false;">
          <span class="nav-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
              <line x1="16" y1="2" x2="16" y2="6"></line>
              <line x1="8" y1="2" x2="8" y2="6"></line>
              <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
          </span>
          <span class="nav-text">Hoje</span>
          <span class="nav-badge" id="badge-today">0</span>
        </a>
        
        <a href="#" class="nav-item" data-filter="next7days" onclick="applySmartFilter('next7days'); closeSidebarMobile(); return false;">
          <span class="nav-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
              <line x1="16" y1="2" x2="16" y2="6"></line>
              <line x1="8" y1="2" x2="8" y2="6"></line>
              <line x1="3" y1="10" x2="21" y2="10"></line>
              <line x1="8" y1="14" x2="16" y2="14"></line>
              <line x1="8" y1="18" x2="12" y2="18"></line>
            </svg>
          </span>
          <span class="nav-text">Prﾃｳximos 7 dias</span>
          <span class="nav-badge" id="badge-next7days">0</span>
        </a>
        
        <a href="#" class="nav-item" data-filter="all" onclick="applySmartFilter('all'); closeSidebarMobile(); return false;">
          <span class="nav-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="8" y1="6" x2="21" y2="6"></line>
              <line x1="8" y1="12" x2="21" y2="12"></line>
              <line x1="8" y1="18" x2="21" y2="18"></line>
              <line x1="3" y1="6" x2="3.01" y2="6"></line>
              <line x1="3" y1="12" x2="3.01" y2="12"></line>
              <line x1="3" y1="18" x2="3.01" y2="18"></line>
            </svg>
          </span>
          <span class="nav-text">Todas as Tarefas</span>
          <span class="nav-badge" id="badge-all">0</span>
        </a>
      </nav>

      <!-- Listas/Projetos -->
      <div class="sidebar-section sidebar-lists-section">
        <div class="section-header">
          <div class="section-header-title">
            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
              <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
            </svg>
            <span>MINHAS LISTAS</span>
          </div>
        </div>
        
        <div class="lists-container" id="listsContainer">
          <!-- As listas sﾃ｣o renderizadas aqui via JS -->
        </div>
        
        <!-- Botﾃ｣o de adicionar lista -->
        <button class="btn-add-list" onclick="showCreateListModal()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
          <span>Nova Lista</span>
        </button>
      </div>

      <!-- Etiquetas (oculto) -->
      <div class="sidebar-section" style="display: none;">
        <div class="section-header">
          <span>Etiquetas</span>
        </div>
        <p class="section-hint">Categorize suas tarefas com etiquetas.</p>
        <div class="tags-container">
          <span class="tag">#urgente</span>
          <span class="tag">#reuniﾃ｣o</span>
          <span class="tag">#ideias</span>
        </div>
      </div>

      <!-- Bottom Actions -->
      <div class="sidebar-bottom">
        <a href="Tela_Concluidas.html" class="nav-item" onclick="closeSidebarMobile();">
          <span class="nav-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
              <polyline points="22 4 12 14.01 9 11.01"></polyline>
            </svg>
          </span>
          <span class="nav-text">Concluﾃｭdo</span>
        </a>
        <a href="Lixeira.html" class="nav-item" onclick="closeSidebarMobile();">
          <span class="nav-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="3 6 5 6 21 6"></polyline>
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              <line x1="10" y1="11" x2="10" y2="17"></line>
              <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
          </span>
          <span class="nav-text">Lixeira</span>
        </a>
        <a href="Tela_Ajustes.html" class="nav-item" onclick="closeSidebarMobile();">
          <span class="nav-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="3"></circle>
              <path d="M12 1v6m0 6v6m6-12-6 6m-6-6 6 6m6 6-6-6m-6 6 6-6"></path>
            </svg>
          </span>
          <span class="nav-text">Configuraﾃｧﾃｵes</span>
        </a>
      </div>
    </aside>

    <!-- ===== ﾃヽEA PRINCIPAL ===== -->
    <main class="main-content" id="mainContent">
      
      <!-- Header da pﾃ｡gina -->
      <header class="page-header">
        <div class="header-left">
          <button class="btn-menu-mobile" id="menuToggle" aria-label="Abrir menu">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="3" y1="12" x2="21" y2="12"></line>
              <line x1="3" y1="6" x2="21" y2="6"></line>
              <line x1="3" y1="18" x2="21" y2="18"></line>
            </svg>
          </button>
          <div class="page-title-group">
            <h1 class="page-title">
              <span class="title-emoji">窓</span>
              <span class="title-text">Bem-vindo</span>
            </h1>
            <span class="task-count" id="taskCountHeader">Vocﾃｪ tem 0 tarefas pendentes</span>
          </div>
        </div>
        
        <div class="header-right">
          <button class="btn-header" id="darkModeToggle" title="Modo Escuro" aria-label="Alternar modo escuro">
            <svg class="sun-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="5"></circle>
              <line x1="12" y1="1" x2="12" y2="3"></line>
              <line x1="12" y1="21" x2="12" y2="23"></line>
              <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
              <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
              <line x1="1" y1="12" x2="3" y2="12"></line>
              <line x1="21" y1="12" x2="23" y2="12"></line>
              <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
              <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
            </svg>
            <svg class="moon-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: none;">
              <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
            </svg>
          </button>
          
          <button class="btn-header" onclick="toggleViewOptionsMenu()" title="Mais opﾃｧﾃｵes" id="btnMoreOptions" aria-label="Mais opﾃｧﾃｵes">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="1"></circle>
              <circle cx="12" cy="5" r="1"></circle>
              <circle cx="12" cy="19" r="1"></circle>
            </svg>
          </button>
        </div>
      </header>

      <!-- Stats Cards (compacto) -->
      <div class="stats-bar">
        <div class="stat-mini">
          <span class="stat-mini-value" id="tarefas-ativas">0</span>
          <span class="stat-mini-label">Ativas</span>
        </div>
        <div class="stat-mini">
          <span class="stat-mini-value" id="tarefas-pendentes">0</span>
          <span class="stat-mini-label">Pendentes</span>
        </div>
        <div class="stat-mini stat-ai">
          <span class="ai-indicator"></span>
          <span class="stat-mini-label">IA Online</span>
        </div>
      </div>

      <!-- Input de Nova Tarefa -->
      <div class="add-task-inline">
        <div class="add-task-wrapper">
          <button class="add-task-trigger" id="btnAdicionar" onclick="openTaskModal()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            <span>Adicionar tarefa</span>
          </button>
          <button class="btn-add-task-submit" onclick="openTaskModal()">Adicionar</button>
        </div>
      </div>

      <!-- Lista de Tarefas -->
      <div class="tasks-container" id="listaTarefas">
        <!-- Tarefas serﾃ｣o carregadas dinamicamente do banco de dados -->
      </div>

    </main>

  </div>

  <!-- ===== MODAIS E OVERLAYS ===== -->

  <!-- MODAL DE CRIAR TAREFA -->
  <div class="task-modal-overlay" id="taskModalOverlay" onclick="closeTaskModal()"></div>

  <div class="task-modal" id="taskModal" role="dialog" aria-modal="true" aria-labelledby="taskModalTitle">
    <!-- Header -->
    <div class="task-modal-header">
      <h3 class="task-modal-title" id="taskModalTitle">Nova Tarefa</h3>
      <button class="btn-close-modal" onclick="closeTaskModal()" title="Fechar (Esc)" aria-label="Fechar modal">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>

    <!-- Body -->
    <div class="task-modal-body">
      <!-- Tﾃｭtulo -->
      <div class="task-modal-field">
        <input 
          type="text" 
          id="inputTituloTarefa" 
          class="task-modal-input task-modal-title-input" 
          placeholder="Tﾃｭtulo da tarefa"
          autocomplete="off"
          enterkeyhint="next"
        />
      </div>

      <!-- Descriﾃｧﾃ｣o -->
      <div class="task-modal-field">
        <textarea 
          id="textareaDescricaoTarefa" 
          class="task-modal-textarea" 
          placeholder="Descriﾃｧﾃ｣o (opcional)"
          rows="3"
        ></textarea>
      </div>

      <!-- Campos inline: Data e Prioridade -->
      <div class="task-modal-inline-fields">
        <!-- Data -->
        <div class="task-modal-field-group">
          <label class="task-modal-label" for="inputDataTarefa">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
              <line x1="16" y1="2" x2="16" y2="6"></line>
              <line x1="8" y1="2" x2="8" y2="6"></line>
              <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
            <span>Data de vencimento</span>
          </label>
          <input 
            type="date" 
            id="inputDataTarefa" 
            class="task-modal-input task-modal-date-input"
          />
        </div>

        <!-- Prioridade -->
        <div class="task-modal-field-group">
          <label class="task-modal-label" for="selectPrioridadeTarefa">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
              <path d="M2 17l10 5 10-5M2 12l10 5 10-5"></path>
            </svg>
            <span>Prioridade</span>
          </label>
          <select id="selectPrioridadeTarefa" class="task-modal-select">
            <option value="low">泙 Baixa</option>
            <option value="medium" selected>泯 Mﾃｩdia</option>
            <option value="high">閥 Alta</option>
          </select>
        </div>
      </div>

      <!-- Seﾃｧﾃ｣o (se aplicﾃ｡vel) -->
      <div class="task-modal-field-group" id="taskModalSectionField" style="display: none;">
        <label class="task-modal-label" for="selectSecaoTarefa">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
          </svg>
          <span>Seﾃｧﾃ｣o</span>
        </label>
        <select id="selectSecaoTarefa" class="task-modal-select">
          <option value="">Sem seﾃｧﾃ｣o</option>
        </select>
      </div>
    </div>

    <!-- Footer -->
    <div class="task-modal-footer">
      <button class="btn-modal-secondary" onclick="closeTaskModal()">
        Cancelar
      </button>
      <button class="btn-modal-primary" id="btnSalvar" onclick="salvarNovaTarefa()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="12" y1="5" x2="12" y2="19"></line>
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
        <span>Criar Tarefa</span>
      </button>
    </div>
  </div>

  <!-- PAINEL LATERAL DE DETALHES DA TAREFA -->
  <div class="task-detail-overlay" id="taskDetailOverlay" onclick="closeTaskDetailPanel()"></div>
  
  <div class="task-detail-panel" id="taskDetailPanel" role="dialog" aria-modal="true">
    <div class="task-detail-header">
      <button class="btn-close-panel" onclick="closeTaskDetailPanel()" aria-label="Fechar painel">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    
    <div class="task-detail-content">
      <!-- Checkbox e Tﾃｭtulo -->
      <div class="task-detail-title-section">
        <label class="task-detail-checkbox">
          <input type="checkbox" id="detailTaskCheckbox" onchange="toggleTaskFromDetail()">
          <span class="checkmark"></span>
        </label>
        <textarea 
          id="detailTaskTitle" 
          class="task-detail-title-input" 
          placeholder="Nome da tarefa" 
          oninput="autoResizeTextarea(this)"
        ></textarea>
      </div>
      
      <!-- Descriﾃｧﾃ｣o -->
      <div class="task-detail-section">
        <div class="task-detail-section-header">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
            <polyline points="14 2 14 8 20 8"></polyline>
            <line x1="16" y1="13" x2="8" y2="13"></line>
            <line x1="16" y1="17" x2="8" y2="17"></line>
            <polyline points="10 9 9 9 8 9"></polyline>
          </svg>
          <span>Descriﾃｧﾃ｣o</span>
        </div>
        <textarea 
          id="detailTaskDescription" 
          class="task-detail-description-input" 
          placeholder="Adicione uma descriﾃｧﾃ｣o..." 
          oninput="autoResizeTextarea(this)"
        ></textarea>
      </div>
      
      <!-- Data de vencimento -->
      <div class="task-detail-section">
        <div class="task-detail-section-header">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="16" y1="2" x2="16" y2="6"></line>
            <line x1="8" y1="2" x2="8" y2="6"></line>
            <line x1="3" y1="10" x2="21" y2="10"></line>
          </svg>
          <span>Data de vencimento</span>
        </div>
        <input 
          type="date" 
          id="detailTaskDueDate" 
          class="task-detail-date-input"
          onchange="updateTaskDueDate()"
        >
      </div>
      
      <!-- Prioridade -->
      <div class="task-detail-section">
        <div class="task-detail-section-header">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 19V6M5 12l7-7 7 7"/>
          </svg>
          <span>Prioridade</span>
        </div>
        <select 
          id="detailTaskPriority" 
          class="task-detail-priority-select"
          onchange="updateTaskPriority()"
        >
          <option value="low">泙 Baixa</option>
          <option value="medium">泯 Mﾃｩdia</option>
          <option value="high">閥 Alta</option>
        </select>
      </div>
      
      <!-- Subtarefas -->
      <div class="task-detail-section">
        <div class="subtasks-section">
          <!-- Header com tﾃｭtulo e botﾃ｣o gerar -->
          <div class="subtasks-header">
            <div class="subtasks-title">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="9 11 12 14 22 4"></polyline>
                <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
              </svg>
              <span>Subtarefas</span>
              <span class="subtasks-count" id="subtasksCount">0</span>
            </div>
            <button class="btn-generate-subtasks" id="btnGenerateSubtasks" onclick="generateSubtasksWithAI()" title="Quebrar tarefa em subtarefas com IA">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                <polyline points="2 17 12 22 22 17"></polyline>
                <polyline points="2 12 12 17 22 12"></polyline>
              </svg>
              <span class="hide-mobile-text">Gerar com IA</span>
            </button>
          </div>

          <!-- Lista de subtarefas -->
          <div class="subtasks-list" id="subtasksList"></div>

          <!-- Input para adicionar subtarefa -->
          <div class="subtask-add-container">
            <button class="subtask-add-trigger" id="btnAddSubtask" onclick="showSubtaskInput()">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg>
              Adicionar subtarefa
            </button>

            <div class="subtask-input-container" id="subtaskInputContainer">
              <input 
                type="text" 
                id="subtaskInput" 
                class="subtask-input" 
                placeholder="Digite a subtarefa..."
                onkeypress="handleSubtaskInputKeypress(event)"
                enterkeyhint="done"
              />
              <button class="btn-subtask-save" onclick="saveNewSubtask()">Adicionar</button>
              <button class="btn-subtask-cancel" onclick="hideSubtaskInput()">Cancelar</button>
            </div>
          </div>

          <!-- Barra de progresso -->
          <div class="subtasks-progress" id="subtasksProgress" style="display: none;">
            <div class="progress-bar-container">
              <div class="progress-bar-fill" id="subtasksProgressBar" style="width: 0%"></div>
            </div>
            <span class="progress-text" id="subtasksProgressText">0/0</span>
          </div>
        </div>
      </div>
      
      <!-- Aﾃｧﾃｵes -->
      <div class="task-detail-actions">
        <button class="btn-detail-delete" onclick="deleteTaskFromDetail()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="3 6 5 6 21 6"></polyline>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
          </svg>
          Excluir tarefa
        </button>
      </div>
    </div>
  </div>

  <!-- MENU DE OPﾃﾃ髭S DE VISUALIZAﾃﾃグ -->
  <div class="view-options-overlay" id="viewOptionsOverlay" onclick="toggleViewOptionsMenu()"></div>
  
  <div class="view-options-menu" id="viewOptionsMenu" role="menu">
    <!-- Visualizaﾃｧﾃ｣o -->
    <div class="menu-section">
      <div class="menu-section-title">Visualizaﾃｧﾃ｣o</div>
      <button class="menu-item" onclick="changeViewMode('lista')" data-view="lista" role="menuitem">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="8" y1="6" x2="21" y2="6"></line>
          <line x1="8" y1="12" x2="21" y2="12"></line>
          <line x1="8" y1="18" x2="21" y2="18"></line>
          <line x1="3" y1="6" x2="3.01" y2="6"></line>
          <line x1="3" y1="12" x2="3.01" y2="12"></line>
          <line x1="3" y1="18" x2="3.01" y2="18"></line>
        </svg>
        <span>Lista</span>
        <svg class="check-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="20 6 9 17 4 12"></polyline>
        </svg>
      </button>
      
      <button class="menu-item" onclick="changeViewMode('kanban')" data-view="kanban" role="menuitem">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="7" height="7"></rect>
          <rect x="14" y="3" width="7" height="7"></rect>
          <rect x="14" y="14" width="7" height="7"></rect>
          <rect x="3" y="14" width="7" height="7"></rect>
        </svg>
        <span>Kanban</span>
        <svg class="check-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="20 6 9 17 4 12"></polyline>
        </svg>
      </button>
      
      <button class="menu-item" onclick="changeViewMode('calendario')" data-view="calendario" role="menuitem">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        <span>Calendﾃ｡rio</span>
        <svg class="check-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="20 6 9 17 4 12"></polyline>
        </svg>
      </button>
    </div>
    
    <div class="menu-divider"></div>
    
    <!-- Opﾃｧﾃｵes de exibiﾃｧﾃ｣o -->
    <button class="menu-item" onclick="toggleHideCompleted()" role="menuitem">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="9 11 12 14 22 4"></polyline>
        <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
      </svg>
      <span>Esconder concluﾃｭdas</span>
      <input type="checkbox" id="toggleHideCompletedCheckbox" class="menu-checkbox" onchange="toggleHideCompleted()" onclick="event.stopPropagation()">
    </button>
    
    <button class="menu-item" onclick="toggleShowDetails()" role="menuitem">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
        <polyline points="14 2 14 8 20 8"></polyline>
        <line x1="16" y1="13" x2="8" y2="13"></line>
        <line x1="16" y1="17" x2="8" y2="17"></line>
      </svg>
      <span>Mostrar detalhes</span>
      <input type="checkbox" id="toggleShowDetailsCheckbox" class="menu-checkbox" onchange="toggleShowDetails()" onclick="event.stopPropagation()">
    </button>
    
    <div class="menu-divider"></div>
    
    <!-- Seﾃｧﾃｵes -->
    <button class="menu-item" onclick="showCreateSectionModal()" role="menuitem">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
      <span>Adicionar Seﾃｧﾃ｣o</span>
    </button>
    
    <div class="menu-divider"></div>
    
    <!-- Outras opﾃｧﾃｵes -->
    <button class="menu-item" onclick="shareList()" role="menuitem">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="18" cy="5" r="3"></circle>
        <circle cx="6" cy="12" r="3"></circle>
        <circle cx="18" cy="19" r="3"></circle>
        <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
        <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
      </svg>
      <span>Compartilhar</span>
    </button>
    
    <button class="menu-item" onclick="openSettings()" role="menuitem">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="3"></circle>
        <path d="M12 1v6m0 6v6m5.2-13.2l-4.2 4.2m0 6l4.2 4.2M23 12h-6m-6 0H1m13.2 5.2l-4.2-4.2m0-6l-4.2-4.2"></path>
      </svg>
      <span>Visualizar Opﾃｧﾃｵes</span>
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-left: auto;">
        <polyline points="9 18 15 12 9 6"></polyline>
      </svg>
    </button>
    
    <div class="menu-divider"></div>
    
    <button class="menu-item" onclick="printList()" role="menuitem">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="6 9 6 2 18 2 18 9"></polyline>
        <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
        <rect x="6" y="14" width="12" height="8"></rect>
      </svg>
      <span>Imprimir</span>
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-left: auto;">
        <polyline points="9 18 15 12 9 6"></polyline>
      </svg>
    </button>
  </div>

  <!-- MODAL DE EDITAR SEﾃﾃグ -->
  <div class="modal-overlay" id="editSectionModalOverlay" onclick="closeEditSectionModal()">
    <div class="modal-edit-section" id="editSectionModal" role="dialog" aria-modal="true" onclick="event.stopPropagation()">
      <div class="modal-header">
        <h3 class="modal-title">Editar Seﾃｧﾃ｣o</h3>
        <button class="btn-close-modal" onclick="closeEditSectionModal()" aria-label="Fechar">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>

      <div class="modal-body">
        <div class="form-field">
          <label class="form-label" for="editSectionNameInput">Nome da seﾃｧﾃ｣o</label>
          <input
            type="text"
            id="editSectionNameInput"
            class="form-input"
            placeholder="Digite o nome"
            maxlength="50"
          />
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeEditSectionModal()">Cancelar</button>
        <button class="btn-primary" onclick="saveEditedSectionName()">Salvar</button>
      </div>
    </div>
  </div>

  <!-- BOTﾃグ FLUTUANTE (NUVEM IA) -->
  <button class="ai-float-button" onclick="openAIRoutinePanel()" title="Gerar rotina com IA" aria-label="Abrir assistente IA">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
      <polyline points="2 17 12 22 22 17"></polyline>
      <polyline points="2 12 12 17 22 12"></polyline>
    </svg>
  </button>

  <!-- OVERLAY AI PANEL -->
  <div id="aiRoutinePanelOverlay" onclick="closeAIRoutinePanel()"></div>

  <!-- PAINEL LATERAL IA -->
  <div id="aiRoutinePanel" role="dialog" aria-modal="true" aria-labelledby="aiPanelTitle">
    <!-- HEADER -->
    <div class="ai-panel-header">
      <div class="ai-panel-header-content">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
          <polyline points="2 17 12 22 22 17"></polyline>
          <polyline points="2 12 12 17 22 12"></polyline>
        </svg>
        <h2 id="aiPanelTitle">Assistente IA</h2>
      </div>
      <button class="ai-panel-close" onclick="closeAIRoutinePanel()" aria-label="Fechar painel IA">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>

    <!-- BODY -->
    <div class="ai-panel-body">
      <!-- DESCRIﾃﾃグ -->
      <div class="ai-form-group">
        <label for="aiRoutineDescription">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
          </svg>
          Descreva como serﾃ｡ seu dia
        </label>
        <textarea 
          id="aiRoutineDescription" 
          class="ai-textarea" 
          placeholder="Ex: Preciso estudar para uma prova importante, fazer exercﾃｭcios, trabalhar num projeto e ter tempo para descanso..."
        ></textarea>
      </div>

      <!-- HORﾃヽIOS -->
      <div class="ai-form-group">
        <label>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <polyline points="12 6 12 12 16 14"></polyline>
          </svg>
          Perﾃｭodo do dia
        </label>
        <div class="ai-time-inputs">
          <input type="time" id="aiStartTime" class="ai-time-input" value="08:00">
          <input type="time" id="aiEndTime" class="ai-time-input" value="18:00">
        </div>
      </div>

      <!-- BOTﾃグ GERAR -->
      <button class="btn-generate-routine" onclick="generateAIRoutine()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
          <polyline points="2 17 12 22 22 17"></polyline>
          <polyline points="2 12 12 17 22 12"></polyline>
        </svg>
        Gerar Rotina
      </button>

      <!-- RESULTADO -->
      <div id="aiRoutineResult"></div>
    </div>
  </div>

  <!-- MODAL DE CONFIRMAﾃﾃグ DE EXCLUSﾃグ -->
  <div class="confirm-modal-overlay" id="confirmModalOverlay">
    <div class="confirm-modal" role="alertdialog" aria-modal="true" aria-labelledby="confirmModalTitle">
      <div class="confirm-modal-content">
        <div class="confirm-modal-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 6h18"></path>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"></path>
            <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            <line x1="10" y1="11" x2="10" y2="17"></line>
            <line x1="14" y1="11" x2="14" y2="17"></line>
          </svg>
        </div>
        
        <h3 class="confirm-modal-title" id="confirmModalTitle">Mover para lixeira?</h3>
        <p class="confirm-modal-message">
          A tarefa serﾃ｡ movida para a lixeira e excluﾃｭda automaticamente apﾃｳs 30 dias. Vocﾃｪ pode restaurﾃ｡-la a qualquer momento.
        </p>
        
        <div class="confirm-modal-task-name" id="confirmModalTaskName">
          Nome da tarefa
        </div>
        
        <div class="confirm-modal-actions">
          <button class="confirm-modal-btn confirm-modal-btn-cancel" onclick="closeConfirmModal()">
            Cancelar
          </button>
          <button class="confirm-modal-btn confirm-modal-btn-delete" id="confirmDeleteBtn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 6h18"></path>
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"></path>
              <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            </svg>
            Mover para lixeira
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL DE CONFIRMAﾃﾃグ DE EXCLUSﾃグ DE LISTA -->
  <div class="confirm-modal-overlay" id="deleteListModalOverlay">
    <div class="confirm-modal" role="alertdialog" aria-modal="true" aria-labelledby="deleteListModalTitle">
      <div class="confirm-modal-content">
        <div class="confirm-modal-icon confirm-modal-icon-list">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 6h18"></path>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"></path>
            <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
          </svg>
        </div>

        <h3 class="confirm-modal-title" id="deleteListModalTitle">Excluir lista?</h3>
        <p class="confirm-modal-message" id="deleteListModalMessage">
          Todas as tarefas e seﾃｧﾃｵes desta lista serﾃ｣o permanentemente excluﾃｭdas.
        </p>

        <div class="confirm-modal-task-name" id="deleteListModalName">
          Nome da lista
        </div>

        <div class="confirm-modal-actions">
          <button class="confirm-modal-btn confirm-modal-btn-cancel" onclick="closeDeleteListModal()">
            Cancelar
          </button>
          <button class="confirm-modal-btn confirm-modal-btn-delete" id="confirmDeleteListBtn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 6h18"></path>
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"></path>
              <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            </svg>
            Excluir
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL DE CONFIRMAﾃﾃグ DE EXCLUSﾃグ DE SEﾃﾃグ -->
  <div class="confirm-modal-overlay" id="deleteSectionModalOverlay" onclick="if(event.target === this) closeDeleteSectionModal()">
    <div class="confirm-modal" role="alertdialog" aria-modal="true" aria-labelledby="deleteSectionModalTitle">
      <div class="confirm-modal-content">
        <div class="confirm-modal-icon confirm-modal-icon-section">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 6h18"></path>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"></path>
            <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
          </svg>
        </div>

        <h3 class="confirm-modal-title" id="deleteSectionModalTitle">Excluir seﾃｧﾃ｣o?</h3>
        <p class="confirm-modal-message" id="deleteSectionModalMessage">
          As tarefas desta seﾃｧﾃ｣o serﾃ｣o movidas para "Tarefas" (sem seﾃｧﾃ｣o).
        </p>

        <div class="confirm-modal-task-name" id="deleteSectionModalName">
          Nome da seﾃｧﾃ｣o
        </div>

        <div class="confirm-modal-actions">
          <button class="confirm-modal-btn confirm-modal-btn-cancel" onclick="closeDeleteSectionModal()">
            Cancelar
          </button>
          <button class="confirm-modal-btn confirm-modal-btn-delete" id="confirmDeleteSectionBtn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 6h18"></path>
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"></path>
              <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            </svg>
            Excluir
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL DE RENOMEAR SEﾃﾃグ KANBAN -->
  <div class="modal-overlay" id="renameSectionModalOverlay" onclick="closeRenameSectionModal()"></div>

  <div class="modal-rename-section" id="renameSectionModal" role="dialog" aria-modal="true">
    <div class="modal-header">
      <h3 class="modal-title">Renomear Seﾃｧﾃ｣o</h3>
      <button class="btn-close-modal" onclick="closeRenameSectionModal()" aria-label="Fechar">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    
    <div class="modal-body">
      <div class="form-field">
        <label class="form-label" for="renameSectionInput">Nome da seﾃｧﾃ｣o</label>
        <input 
          type="text" 
          id="renameSectionInput" 
          class="form-input" 
          placeholder="Digite o novo nome"
          maxlength="50"
          autocomplete="off"
          onkeypress="if(event.key === 'Enter') { event.preventDefault(); saveRenamedSection(); }"
        />
        <span class="form-hint">Mﾃ｡ximo 50 caracteres</span>
      </div>
    </div>
    
    <div class="modal-footer">
      <button class="btn-secondary" onclick="closeRenameSectionModal()">Cancelar</button>
      <button class="btn-primary" id="btnSaveRenamedSection" onclick="saveRenamedSection()">Salvar</button>
    </div>
  </div>

  <!-- ========================================
       MODAL DE EDITAR LISTA
       ======================================== -->
  <div class="list-modal-overlay" id="editListModalOverlay">
    <div class="list-modal" id="editListModal" role="dialog" aria-modal="true" aria-labelledby="editListModalTitle">
      <!-- Header -->
      <div class="list-modal-header">
        <h3 class="list-modal-title" id="editListModalTitle">Editar Lista</h3>
        <button class="btn-close-modal" onclick="closeEditListModal()" aria-label="Fechar modal">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>

      <!-- Body -->
      <div class="list-modal-body">
        <div class="form-group">
          <label for="editListName">Nome da Lista</label>
          <input
            type="text"
            id="editListName"
            class="list-form-input"
            placeholder="Digite o nome da lista"
            maxlength="50"
            autocomplete="off"
          />
        </div>

        <!-- Campos ocultos (mantidos para compatibilidade) -->
        <input type="hidden" id="editListColor" value="#146551" />
        <input type="hidden" id="editListEmojiBtn" value="搭" />
      </div>

      <!-- Footer -->
      <div class="list-modal-footer">
        <button class="btn-cancel" onclick="closeEditListModal()">
          Cancelar
        </button>
        <button class="btn-save" id="btnSaveEditList" onclick="saveEditedList()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
            <polyline points="17 21 17 13 7 13 7 21"></polyline>
            <polyline points="7 3 7 8 15 8"></polyline>
          </svg>
          Salvar
        </button>
      </div>
    </div>
  </div>

  <!-- ===== SCRIPTS ===== -->
  <script src="../scripts/settings.js"></script>
  <script src="../scripts/lists.js"></script>
  <script src="../scripts/sections.js"></script>
  <script src="../scripts/kanban-view.js"></script>
  <script src="../scripts/plan-service.js"></script>
  <script src="../scripts/sincro_telas.js"></script>
  <script src="../scripts/smart-filters.js"></script> 
  <script src="../scripts/estatisticas_backend.js"></script>
  <script src="../scripts/darkMode.js"></script>
  <script src="../scripts/task-detail-panel.js"></script>
  <script src="../scripts/view-options-menu.js"></script>
  <script src="../scripts/ai-routine-panel.js"></script>
  <script src="../scripts/subtasks.js"></script>

  <script>
    // ===== SIDEBAR MOBILE TOGGLE =====
    const menuToggle = document.getElementById('menuToggle');
    const sidebar = document.getElementById('sidebar');
    const sidebarOverlay = document.getElementById('sidebarOverlay');
    const btnCloseSidebar = document.getElementById('btnCloseSidebar');
    
    // Funﾃｧﾃ｣o para abrir sidebar
    function openSidebar() {
      sidebar.classList.add('active');
      sidebarOverlay.classList.add('active');
      document.body.style.overflow = 'hidden'; // Previne scroll do body
    }
    
    // Funﾃｧﾃ｣o para fechar sidebar
    function closeSidebarMobile() {
      sidebar.classList.remove('active');
      sidebarOverlay.classList.remove('active');
      document.body.style.overflow = ''; // Restaura scroll
    }
    
    // Event listeners
    menuToggle?.addEventListener('click', openSidebar);
    sidebarOverlay?.addEventListener('click', closeSidebarMobile);
    btnCloseSidebar?.addEventListener('click', closeSidebarMobile);
    
    // Fechar sidebar com tecla Escape
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeSidebarMobile();
        closeTaskModal();
        closeTaskDetailPanel();
        
        // Fechar menu de opﾃｧﾃｵes se estiver aberto
        const viewMenu = document.getElementById('viewOptionsMenu');
        if (viewMenu?.classList.contains('active')) {
          toggleViewOptionsMenu();
        }
      }
    });
    
    // ===== TOGGLE SEﾃﾃ髭S COLAPSﾃ〃EIS =====
    document.querySelectorAll('.section-toggle').forEach(btn => {
      btn.addEventListener('click', () => {
        const section = btn.dataset.section;
        const tasks = document.getElementById(`section-${section}`);
        const chevron = btn.querySelector('.chevron');
        
        tasks?.classList.toggle('collapsed');
        chevron?.classList.toggle('rotated');
      });
    });

    // ===== ABRIR MODAL DE TAREFA =====
    const btnAdicionar = document.getElementById('btnAdicionar');
    const btnNovaGlobal = document.getElementById('btnNovaGlobal');

    btnAdicionar?.addEventListener('click', () => {
      openTaskModal();
      closeSidebarMobile(); // Fecha sidebar ao abrir modal no mobile
    });
    
    btnNovaGlobal?.addEventListener('click', () => {
      openTaskModal();
      closeSidebarMobile(); // Fecha sidebar ao abrir modal no mobile
    });

    // ===== CHECKBOX TOGGLE (DELEGAﾃﾃグ DE EVENTOS) =====
    document.addEventListener('click', function(e) {
      if (e.target.closest('.task-checkbox input')) {
        const checkbox = e.target;
        const taskItem = checkbox.closest('.task-item');
        const taskId = taskItem?.dataset.taskId;

        if (taskId) {
          if (typeof toggleTaskFromHome === 'function') {
            toggleTaskFromHome(parseInt(taskId));
          }
        } else {
          taskItem?.classList.toggle('completed', checkbox.checked);
        }
      }
    });

    // ===== ATUALIZAR ESTATﾃ拘TICAS AO CARREGAR =====
    window.addEventListener('load', () => {
      if (typeof atualizarEstatisticas === 'function') {
        atualizarEstatisticas();
      }
    });
    
    // ===== PREVENIR ZOOM EM INPUTS NO iOS =====
    document.querySelectorAll('input, select, textarea').forEach(el => {
      el.addEventListener('focus', function() {
        if (window.innerWidth <= 768) {
          document.querySelector('meta[name="viewport"]')
            .setAttribute('content', 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no');
        }
      });
      
      el.addEventListener('blur', function() {
        document.querySelector('meta[name="viewport"]')
          .setAttribute('content', 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no');
      });
    });
    
    // ===== DETECTAR SWIPE PARA ABRIR SIDEBAR (MOBILE) =====
    let touchStartX = 0;
    let touchEndX = 0;
    
    document.addEventListener('touchstart', e => {
      touchStartX = e.changedTouches[0].screenX;
    }, { passive: true });
    
    document.addEventListener('touchend', e => {
      touchEndX = e.changedTouches[0].screenX;
      handleSwipe();
    }, { passive: true });
    
    function handleSwipe() {
      const swipeThreshold = 80;
      const swipeDistance = touchEndX - touchStartX;
      
      // Swipe da esquerda para direita (abrir sidebar)
      if (touchStartX < 30 && swipeDistance > swipeThreshold && !sidebar.classList.contains('active')) {
        openSidebar();
      }
      
      // Swipe da direita para esquerda (fechar sidebar)
      if (swipeDistance < -swipeThreshold && sidebar.classList.contains('active')) {
        closeSidebarMobile();
      }
    }
    
    // ===== ATUALIZAR CONTADOR DE TAREFAS NO HEADER =====
    function updateTaskCountHeader(count) {
      const taskCountHeader = document.getElementById('taskCountHeader');
      if (taskCountHeader) {
        taskCountHeader.textContent = `Vocﾃｪ tem ${count} tarefa${count !== 1 ? 's' : ''} pendente${count !== 1 ? 's' : ''}`;
      }
    }
    
    // Expor funﾃｧﾃ｣o globalmente
    window.updateTaskCountHeader = updateTaskCountHeader;
    window.closeSidebarMobile = closeSidebarMobile;
    window.openSidebar = openSidebar;
    
    console.log('笨 Tela Inicial carregada com responsividade');

     // ===== MODAL DE EDITAR LISTA =====
    // Usa window.editingListId para compartilhar com lists.js
    window.editingListId = window.editingListId || null;

function openEditListModal(listId, listName, listColor, listEmoji) {
    console.log('統 Abrindo modal de editar lista:', listId);

    window.editingListId = listId;

    // Remove foco de qualquer elemento antes
    document.activeElement?.blur();

    document.getElementById('editListName').value = listName || '';
    document.getElementById('editListColor').value = listColor || '#146551';
    document.getElementById('editListEmojiBtn').textContent = listEmoji || '搭';

    const overlay = document.getElementById('editListModalOverlay');
    const modal = document.getElementById('editListModal');

    overlay.style.display = 'flex';
    overlay.classList.add('active');
    modal.classList.add('active');

    document.body.style.overflow = 'hidden';

    // Foco com delay maior e verificaﾃｧﾃ｣o
    setTimeout(() => {
        const input = document.getElementById('editListName');
        if (input && document.activeElement !== input) {
            input.focus();
        }
    }, 300);
}

    function closeEditListModal() {
        console.log('笶 Fechando modal de editar lista');

        const overlay = document.getElementById('editListModalOverlay');
        const modal = document.getElementById('editListModal');

        overlay.classList.remove('active');
        modal.classList.remove('active');

        setTimeout(() => {
            overlay.style.display = 'none';
            window.editingListId = null;
        }, 200);

        document.body.style.overflow = '';
    }

    async function saveEditedList() {
        if (!window.editingListId) {
            console.error('笶 Nenhuma lista selecionada');
            return;
        }

        const name = document.getElementById('editListName').value.trim();
        const color = document.getElementById('editListColor').value;
        const emoji = document.getElementById('editListEmojiBtn').textContent;

        if (!name) {
            alert('Por favor, insira um nome para a lista');
            document.getElementById('editListName').focus();
            return;
        }

        const user = getCurrentUser();
        if (!user || !user.id) {
            alert('Erro: Usuﾃ｡rio nﾃ｣o identificado');
            return;
        }

        console.log('沈 Salvando lista editada:', { id: window.editingListId, name, color, emoji });

        try {
            const response = await fetch(`/api/lists/${window.editingListId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'x-user-id': user.id.toString()
                },
                body: JSON.stringify({
                    name,
                    color,
                    emoji,
                    user_id: user.id
                })
            });
            
            const data = await response.json();
            
            if (data.success) {
                console.log('笨 Lista atualizada com sucesso');
                closeEditListModal();
                
                if (typeof loadLists === 'function') {
                    loadLists();
                }
                
                if (typeof renderAllTasks === 'function') {
                    renderAllTasks();
                }
            } else {
                throw new Error(data.error || 'Erro ao atualizar lista');
            }
        } catch (error) {
            console.error('笶 Erro ao salvar lista:', error);
            alert('笶 Erro ao atualizar lista');
        }
    }

    function selectEmoji() {
        const emojis = ['搭', '東', '箝', '識', '直', '匠', '耳', '答', '庁', '櫨', '笨', '噫'];
        const current = document.getElementById('editListEmojiBtn').textContent;
        const currentIndex = emojis.indexOf(current);
        const nextIndex = (currentIndex + 1) % emojis.length;
        document.getElementById('editListEmojiBtn').textContent = emojis[nextIndex];
    }

    // Fechar ao clicar no overlay
    document.getElementById('editListModalOverlay')?.addEventListener('click', (e) => {
        if (e.target.id === 'editListModalOverlay') {
            closeEditListModal();
        }
    });

    // Expor funﾃｧﾃｵes globalmente
    window.openEditListModal = openEditListModal;
    window.closeEditListModal = closeEditListModal;
    window.saveEditedList = saveEditedList;
    window.selectEmoji = selectEmoji;

    console.log('笨 Modal de Editar Lista carregado');
  </script>

  <script>
// ===== GARANTIR MODAL FECHADO NO INﾃ垢IO =====
(function() {
    const overlay = document.getElementById('editListModalOverlay');
    const modal = document.getElementById('editListModal');

    if (overlay && modal) {
        overlay.classList.remove('active');
        modal.classList.remove('active');
        overlay.style.display = 'none';
    }
})();
</script>

</body>

</html>